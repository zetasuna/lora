---
Title: DevOps Project
---

## Architecture

```txt

                    +-------------------+
                    |     Sensor(s)     |
                    |-------------------|
                    |      LoraWan      |
                    +-------------------+
                              |
                              |
                           LoraWan
                              |
                              v
                    +-------------------+
                    |      Gateway      |
                    |-------------------|
                    | - LoraWan         |
                    | - MQTT Publisher  |
                    | - SQLite          |
                    |  (ML Prediction)  |
                    +-------------------+
                              |
                              |
                         MQTT Publish
                              |
                              v
                  +-------------------------+
                  |       MQTT Broker       |
                  |-------------------------|
                  | (EMQX, Mosquitto, etc.) |
                  +-------------------------+
                              ^
                              |
                        Internet (TLS)
                              |
                        MQTT Subscribe
                              |
                              |
                +-----------------------------+
                |      Consumer (Cloud)       |
                |-----------------------------|
                | - MQTT Subscriber           |
                | - L∆∞u Data v√†o SQLite       |
                | - Websocket Server          |
                | - HTTP Server (HTMX + UI)   |
                | - Tailwind UI Templates     |
                +-----------------------------+
                              |
                              |
             +----------------+----------------+
             |                                 |
  WebSocket (Push realtime)            HTTP Query (HTMX)
             |                                 |
   +--------------------+           +-------------------------+
   | Realtime Live View |           | Historical Query + Alert|
   +--------------------+           +-------------------------+
```

## Tri·ªÉn khai Kubernetes

- Tri·ªÉn khai ƒë∆∞·ª£c Kubernetes th√¥ng qua c√¥ng c·ª• minikube tr√™n 1 node
- Tri·ªÉn khai ƒë∆∞·ª£c Kubernetes th√¥ng qua c√¥ng c·ª• kubeadm ho·∫∑c kubespray
  l√™n 1 master node VM + 1 worker node VM

## K8S Helm Chart

- C√†i ƒë·∫∑t ArgoCD l√™n Kubernetes Cluster, expose ƒë∆∞·ª£c ArgoCD qua NodePort
- C√†i ƒë·∫∑t Jenkins l√™n Kubernetes Cluster, expose ƒë∆∞·ª£c Jenkins qua NodePort
- Vi·∫øt ho·∫∑c t√¨m m·∫´u Helm Chart cho app b·∫•t k·ª≥, ƒë·ªÉ v√†o 1 folder ri√™ng trong repo app
- T·∫°o Repo Config cho app tr√™n, trong repo n√†y ch·ª©a c√°c file values.yaml
  v·ªõi n·ªôi dung c·ªßa c√° file values.yaml l√† c√°c config c·∫ßn thi·∫øt
  ƒë·ªÉ ch·∫°y ·ª©ng d·ª•ng tr√™n k8s b·∫±ng Helm Chart
- Vi·∫øt 1 lu·ªìng CI/CD cho app, khi c√≥ thay ƒë·ªïi t·ª´ source code
  1 tag m·ªõi ƒë∆∞·ª£c t·∫°o ra tr√™n tr√™n repo n√†y th√¨ lu·ªìng CI/CD
  t∆∞∆°ng ·ª©ng c·ªßa repo ƒë√≥ th·ª±c hi·ªán c√°c c√¥ng vi·ªác sau:
  - S·ª≠a code trong source code
  - Th·ª±c hi·ªán build source code tr√™n Jenkin b·∫±ng docker
    v·ªõi image tag l√† tag name ƒë√£ ƒë∆∞·ª£c t·∫°o ra tr√™n gitlab/github
    v√† push docker image sau khi build xong l√™n Docker Hub
  - S·ª≠a gi√° tr·ªã Image version trong file values.yaml trong config repo
    v√† push thay ƒë·ªïi l√™n config repo
  - C·∫•u h√¨nh ArgoCD t·ª± ƒë·ªông tri·ªÉn khai l·∫°i web Deployment v√† api Deployment
    khi c√≥ s·ª± thay ƒë·ªïi tr√™n config repo

## Monitor

- Expose metric c·ªßa app ra 1 http path
- S·ª≠ d·ª•ng ansible playbooks ƒë·ªÉ tri·ªÉn khai container Prometheus server.
  Sau ƒë√≥ c·∫•u h√¨nh prometheus add target gi√°m s√°t c√°c metrics ƒë√£ expose ·ªü tr√™n
- S·ª≠ d·ª•ng ansible playbooks ƒë·ªÉ tri·ªÉn khai stack EFK (elasticsearch, fluentd, kibana)
  Sau ƒë√≥ c·∫•u h√¨nh logging cho web service v√† api service,
  ƒë·∫£m b·∫£o khi c√≥ http request g·ª≠i v√†o web service ho·∫∑c api service
  th√¨ trong c√°c log m√† c√°c service n√†y sinh ra, c√≥ √≠t nh·∫•t 1 log c√≥ c√°c th√¥ng tin

## Security

- D·ª±ng HAProxy Loadbalancer tr√™n 1 VM ri√™ng
  (trong tr∆∞·ªùng h·ª£p c·ª•m lab ri√™ng c·ªßa sinh vi√™n)
  v·ªõi mode TCP, m·ªü port tr√™n LB tr·ªè ƒë·∫øn NodePort c·ªßa App tr√™n K8S Cluster
- S·ª≠ d·ª•ng gi·∫£i ph√°p Ingress cho c√°c deployment,
  ƒë·∫£m b·∫£o c√°c truy c·∫≠p ƒë·∫øn c√°c port App s·ª≠ d·ª•ng https
- Cho ph√©p sinh vi√™n s·ª≠ d·ª•ng self-signed cert ƒë·ªÉ l√†m b√†i

---

## üèóÔ∏è **T·ªîNG TH·ªÇ KI·∫æN TR√öC**

```plaintext
+----------------+       +------------------+       +-------------------+        +-------------------+
| Sensor gi·∫£ l·∫≠p | ====> |   Gateway x·ª≠ l√Ω  | ====> | Cloud / AWS Layer | ====>  | Web Monitoring UI |
| (Python Script)|       | (FastAPI/Django) |       |   (API / DB)      |        |   (Django + HTMX) |
+----------------+       +------------------+       +-------------------+        +-------------------+
                               |                                                       ^
                               v                                                       |
                (X·ª≠ l√Ω d·ªØ li·ªáu, l√†m s·∫°ch, format)                                      |
                               |                                                       |
                               +--------------------> Redis / PostgreSQL <-------------+
```

---

## üß© **CHI TI·∫æT C√îNG C·ª§ / STACK CHO T·ª™NG TH√ÄNH PH·∫¶N**

### üîß **1. Sensor m√¥ ph·ªèng (Python Script)**

| Th√†nh ph·∫ßn     | C√¥ng ngh·ªá                        | Vai tr√≤                                                |
| -------------- | -------------------------------- | ------------------------------------------------------ |
| Sensor Script  | `Python`                         | Sinh d·ªØ li·ªáu ng·∫´u nhi√™n (gi√° tr·ªã m·ª±c n∆∞·ªõc, √°p su·∫•t...) |
| Giao ti·∫øp      | `HTTP` (POST) ho·∫∑c `MQTT`        | G·ª≠i ƒë·∫øn Gateway                                        |
| L·∫≠p l·ªãch       | `schedule`, `time.sleep`, `cron` | G·ª≠i d·ªØ li·ªáu ƒë·ªãnh k·ª≥                                    |
| Format d·ªØ li·ªáu | JSON                             | Chu·∫©n h√≥a format g·ª≠i                                   |

> üìÅ V√≠ d·ª• th∆∞ vi·ªán: `random`, `schedule`, `paho-mqtt`, `requests`

### ‚öôÔ∏è **2. Gateway x·ª≠ l√Ω d·ªØ li·ªáu (Python)**

| Th√†nh ph·∫ßn       | C√¥ng ngh·ªá                   | Vai tr√≤                        |
| ---------------- | --------------------------- | ------------------------------ |
| Web Server       | `FastAPI` **ho·∫∑c** `Django` | Nh·∫≠n d·ªØ li·ªáu t·ª´ sensor         |
| Data Cleaning    | Python logic                | L√†m s·∫°ch, check anomaly        |
| Queue (tu·ª≥ ch·ªçn) | `Redis` + `Celery`          | Batch x·ª≠ l√Ω ho·∫∑c async         |
| G·ª≠i l√™n Cloud    | `requests`, `boto3`         | G·ª≠i ti·∫øp l√™n cloud API ho·∫∑c DB |
| Ghi log          | `loguru`, `logging`         | Ghi nh·∫≠t k√Ω g·ª≠i nh·∫≠n d·ªØ li·ªáu   |

> ‚úÖ _FastAPI g·ªçn nh·∫π, d·ªÖ tri·ªÉn khai cho microservice. Django th√≠ch h·ª£p n·∫øu b·∫°n d√πng chung project v·ªõi Web UI._

### ‚òÅÔ∏è **3. Cloud (AWS ho·∫∑c mock server)**

| Th√†nh ph·∫ßn                        | C√¥ng ngh·ªá                                      | Vai tr√≤                            |
| --------------------------------- | ---------------------------------------------- | ---------------------------------- |
| API Gateway                       | `AWS API Gateway` ho·∫∑c custom FastAPI endpoint | Nh·∫≠n request t·ª´ Gateway            |
| L∆∞u tr·ªØ th·ªùi gian th·ª±c            | `AWS DynamoDB` ho·∫∑c `PostgreSQL`               | L∆∞u d·ªØ li·ªáu c·∫£m bi·∫øn               |
| X·ª≠ l√Ω realtime (tu·ª≥ ch·ªçn)         | `AWS Lambda`, `Kinesis`                        | X·ª≠ l√Ω ho·∫∑c filter d·ªØ li·ªáu realtime |
| S·ª≠ d·ª•ng local (n·∫øu ch∆∞a d√πng AWS) | FastAPI ho·∫∑c PostgreSQL local                  | D·ªÖ test, ch∆∞a c·∫ßn deploy AWS       |

> ‚úÖ B·∫°n c√≥ th·ªÉ d√πng local PostgreSQL ban ƒë·∫ßu r·ªìi chuy·ªÉn sang DynamoDB ho·∫∑c RDS sau.

### üåê **4. Website monitoring realtime**

| Th√†nh ph·∫ßn         | C√¥ng ngh·ªá                        | Vai tr√≤                           |
| ------------------ | -------------------------------- | --------------------------------- |
| Backend web        | `Django`                         | Hi·ªÉn th·ªã dashboard                |
| Frontend UI        | `HTMX` + `Tailwind CSS`          | T·∫°o giao di·ªán ƒë·ªông ƒë∆°n gi·∫£n       |
| Giao ti·∫øp realtime | **2 l·ª±a ch·ªçn**:                  |                                   |
|                    | ‚úÖ `HTMX polling` (5s/l·∫ßn...)    | D·ªÖ l√†m, d·ªÖ debug                  |
|                    | ‚úÖ `Django Channels` + WebSocket | Giao ti·∫øp th·ªùi gian th·ª±c th·ª±c th·ª• |
| DB                 | PostgreSQL (chia s·∫ª v·ªõi Gateway) | L∆∞u d·ªØ li·ªáu c·∫£m bi·∫øn              |

> üîÅ _HTMX l√† gi·∫£i ph√°p ƒë∆°n gi·∫£n v√† hi·ªáu qu·∫£. N·∫øu c·∫ßn realtime "live stream", n√™n d√πng WebSocket._

## üß∞ T·ªîNG H·ª¢P C√ÅC C√îNG C·ª§ ƒê·ªÄ XU·∫§T

| M·ª•c ti√™u                   | C√¥ng c·ª• c·ª• th·ªÉ                        |
| -------------------------- | ------------------------------------- |
| Sinh d·ªØ li·ªáu c·∫£m bi·∫øn      | Python, `random`, `schedule`          |
| Giao ti·∫øp Sensor ‚Üí Gateway | HTTP (POST) ho·∫∑c MQTT                 |
| Gateway x·ª≠ l√Ω d·ªØ li·ªáu      | FastAPI ho·∫∑c Django                   |
| Queue x·ª≠ l√Ω (t√πy ch·ªçn)     | Redis + Celery                        |
| L∆∞u d·ªØ li·ªáu                | PostgreSQL ho·∫∑c DynamoDB              |
| Giao ti·∫øp Gateway ‚Üí Cloud  | HTTP ho·∫∑c AWS SDK (boto3)             |
| Web UI                     | Django + HTMX + Tailwind              |
| Realtime frontend          | HTMX polling **ho·∫∑c** Django Channels |
| Logging / Debug            | loguru, Django Debug Toolbar          |

## üóÇÔ∏è K·∫æ HO·∫†CH TRI·ªÇN KHAI G·ª¢I √ù

1. ‚úÖ Giai ƒëo·∫°n 1: C·∫£m bi·∫øn + Gateway + l∆∞u local PostgreSQL
2. ‚úÖ Giai ƒëo·∫°n 2: X√¢y website theo th·ªùi gian th·ª±c v·ªõi polling HTMX
3. ‚úÖ Giai ƒëo·∫°n 3: ƒê∆∞a Gateway l√™n cloud (deploy API)
4. ‚úÖ Giai ƒëo·∫°n 4: D√πng WebSocket (Django Channels) ho·∫∑c chuy·ªÉn sang AWS IoT

---
